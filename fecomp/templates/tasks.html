{% extends 'base.html' %}
{% block title %}Minhas Tarefas{% endblock %}

{% block content %}
<h2 class="page-title">Minhas Tarefas</h2>

<div class="task-container">
    <h3 class="task-section-title">Pendentes</h3>
    <div class="task-grid">
    {% for task in pending_tasks %}
        <div class="task-card task-pending">
            <div class="task-card-header">
                <strong>{{ task.title }}</strong>
                <span>{{ task.course.name }}</span>
            </div>
            <div class="task-card-body">
                <p><strong>Prazo:</strong> {{ task.due_date.strftime('%d/%m/%Y %H:%M') if task.due_date else 'Sem prazo' }}</p>
                <form action="{{ url_for('visoes.submit_task', task_id=task.id) }}" method="post" enctype="multipart/form-data" class="task-submit-form">
                    {{ form.hidden_tag() }}
                    <input type="file" name="file" required class="task-file-input">
                    <button type="submit" class="btn-entrar task-submit-btn">Enviar</button>
                </form>
            </div>
        </div>
    {% else %}
        <p>Você não tem tarefas pendentes!</p>
    {% endfor %}
    </div>
</div>

<div class="task-container">
    <h3 class="task-section-title">Concluídas</h3>
    <div class="task-grid">
    {% for sub in completed_submissions %}
        <div class="task-card task-completed">
            <div class="task-card-header">
                <strong>{{ sub.task.title }}</strong>
                <span>{{ sub.task.course.name }}</span>
            </div>
            <div class="task-card-body">
                <p><strong>Enviado em:</strong> {{ sub.submitted_at.strftime('%d/%m/%Y %H:%M') }}</p>
                <p><strong>Nota:</strong> <span class="task-grade">{{ sub.grade if sub.grade else 'Aguardando correção' }}</span></p>
                
                {% if sub.feedback %}
                <div class="task-feedback">
                    <strong>Feedback do Professor:</strong>
                    <p>{{ sub.feedback }}</p>
                </div>
                {% endif %}
                
                <a href="{{ url_for('visoes.uploaded_file', filename=sub.file.filename) }}" target="_blank" class="task-view-file-btn">
                    Ver meu envio
                </a>
            </div>
        </div>
    {% endfor %}
    {% if not completed_submissions %}
    <p>Nenhuma tarefa concluída ainda.</p>
    {% endif %}
    </div>
</div>
{% endblock %}