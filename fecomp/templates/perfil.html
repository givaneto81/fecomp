{% extends 'base.html' %}

{% block title %}Perfil{% endblock %}

{% block content %}
<div class="profile-container">
    <img src="{{ url_for('static', filename='avatars/' + user.profile_pic) }}" 
         alt="Foto de Perfil" 
         class="profile-pic"
         onerror="this.src='{{ url_for('static', filename='avatars/default_avatar.png') }}';">
    
    <div class="avatar-upload-form" style="margin-top: 20px; width: 100%;">
        <form action="{{ url_for('visoes.upload_avatar') }}" method="post" enctype="multipart/form-data" class="modal-form" style="margin-top: 0; gap: 10px;">
            {{ form.hidden_tag() }} <input type="file" name="avatar" accept="image/png, image/jpeg, image/gif" required style="flex-grow: 1;">
            <button type="submit" class="profile-btn" style="padding: 8px 15px; font-size: 0.9em; margin: 0; flex-shrink: 0;">Enviar Foto</button>
        </form>
    </div>
    <h2 class="profile-name" style="margin-top: 20px;">Nome: {{ user.name }}</h2>
    <h3 class="profile-email">Email: {{ user.email }}</h3>
    <div class="profile-actions">
        <button id="edit-name-btn" class="profile-btn">Editar Nome</button>
        <button id="change-password-btn" class="profile-btn">Alterar Senha</button>
        <button id="delete-account-btn" class="profile-btn delete">Excluir Conta</button>
    </div>
</div>

<div id="edit-name-modal" class="modal">
    <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h2>Editar Nome</h2>
        <form action="{{ url_for('visoes.update_profile') }}" method="post" class="modal-form">
            {{ form.hidden_tag() }} {# <--- CORRIGIDO #}
            <label for="new_name">Novo Nome:</label>
            <input type="text" id="new_name" name="new_name" value="{{ user.name }}" required>
            <button type="submit" class="btn-entrar">Salvar</button>
        </form>
    </div>
</div>

<div id="change-password-modal" class="modal">
    <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h2>Alterar Senha</h2>
        <form action="{{ url_for('visoes.change_password') }}" method="post" class="modal-form">
            {{ form.hidden_tag() }} {# <--- CORRIGIDO #}
            <label for="current_password">Senha Atual:</label>
            <input type="password" id="current_password" name="current_password" required>
            <label for="new_password">Nova Senha:</label>
            <input type="password" id="new_password" name="new_password" required>
            <button type="submit" class="btn-entrar">Alterar</button>
        </form>
    </div>
</div>

<div id="delete-account-modal" class="modal">
    <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h2>Excluir Conta</h2>
        <p>Você tem certeza? Esta ação é irreversível e todos os seus dados serão perdidos.</p>
        <form action="{{ url_for('visoes.delete_account') }}" method="post">
            {{ form.hidden_tag() }} {# <--- CORRIGIDO #}
            <button type="submit" class="profile-btn delete">Sim, excluir minha conta</button>
        </form>
    </div>
</div>
{% endblock %}

{% block page_scripts %}
<script src="{{ url_for('static', filename='js/perfil.js') }}"></script>
{% endblock %}