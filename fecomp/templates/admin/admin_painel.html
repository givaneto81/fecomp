{% extends 'admin/admin_base.html' %}
{% block title %}Painel de Admin{% endblock %}

{% block content %}
<h2 class="page-title">Painel de Gestão</h2>

{% if user_role == 'admin' %}
<div class="form-container">
    <form action="{{ url_for('admin_bp.create_course') }}" method="post" class="add-subject-form">
        {{ form.hidden_tag() }}
        <h3>Criar Nova Turma</h3>
        <input type="text" name="course_name" placeholder="Nome da Turma (Ex: Terceirão 2025)" required>
        <button type="submit">Criar Turma</button>
    </form>
</div>
{% endif %}

<h3 class="page-title" style="font-size: 1.5em;">Minhas Turmas</h3>

<style>
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 20px;
        width: 100%;
        max-width: 1200px;
    }
    .stats-card {
        background-color: var(--content-bg-color);
        border-radius: 10px;
        box-shadow: 0 4px 10px var(--shadow-color);
        padding: 20px;
        text-decoration: none;
        color: var(--text-color);
        transition: transform 0.2s, box-shadow 0.2s;
        border-top: 4px solid var(--primary-color);
    }
    .stats-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px var(--shadow-color);
    }
    .stats-card h4 {
        margin: 0 0 15px 0;
        font-size: 1.3em;
        color: var(--primary-color);
    }
    .stat-item {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 1.1em;
        margin-bottom: 10px;
    }
    .stat-item .feather {
        width: 20px;
        height: 20px;
        color: var(--text-color-light);
    }
    .stat-item-red {
        color: var(--danger-color);
        font-weight: 600;
    }
</style>

<div class="stats-grid">
    {% for data in course_data %}
        <a href="{{ url_for('admin_bp.manage_course', course_id=data.course.id) }}" class="stats-card">
            <h4>{{ data.course.name }}</h4>
            <div class="stat-item">
                <i data-feather="users"></i>
                <span>{{ data.members_count }} Membros</span>
            </div>
            <div class="stat-item">
                <i data-feather="book-open"></i>
                <span>{{ data.course.subjects|length }} Matérias</span>
            </div>
            <div class="stat-item">
                <i data-feather="check-square"></i>
                <span>{{ data.course.tasks|length }} Tarefas Criadas</span>
            </div>
            {% if data.pending_submissions > 0 %}
            <div class="stat-item stat-item-red">
                <i data-feather="alert-circle"></i>
                <span>{{ data.pending_submissions }} Envios Pendentes</span>
            </div>
            {% else %}
            <div class="stat-item">
                <i data-feather="coffee"></i>
                <span>Nenhuma correção pendente</span>
            </div>
            {% endif %}
        </a>
    {% endfor %}
</div>

{% if not course_data %}
<p>Você ainda não {% if user_role == 'admin' %}criou nenhuma turma{% else %}está em nenhuma turma{% endif %}.</p>
{% endif %}
{% if user_role == 'admin' %}
<hr>
<h3 class="page-title" style="font-size: 1.5em;">Gestão de Usuários</h3>
<p><a href="{{ url_for('admin_bp.manage_users') }}" class="profile-btn">Gerir Permissões (Aluno/Professor/Admin)</a></p>
{% endif %}

{% endblock %}